!function(){var e=angular.module("nzDatepicker",[]);e.directive("nzDatepicker",["$compile","$timeout",function(e,t){var n="CUSTOM",a=['<div ng-show="visible" class="nz-datepicker-picker" ng-click="handlePickerClick($event)" ng-class="{\'nz-datepicker-ranged\': showRanged }">','    <div class="nz-datepicker-timesheet">','        <a ng-click="move(-1, $event)" class="nz-datepicker-prev-month">&#9664;</a>','        <div ng-repeat="month in months" class="nz-datepicker-month">','            <div class="nz-datepicker-month-name">{{month.name}}</div>','            <table class="nz-datepicker-calendar">',"                <tr>",'                    <th ng-repeat="day in month.weeks[1]" class="nz-datepicker-calendar-weekday">{{day.date.format(\'dd\')}}</th>',"                </tr>",'                <tr ng-repeat="week in month.weeks">',"                    <td ng-class=\"{'nz-datepicker-calendar-day': day,'nz-datepicker-calendar-day-selected': day.selected,'nz-datepicker-calendar-day-disabled': day.disabled,'nz-datepicker-calendar-day-start': day.start}\" ng-repeat=\"day in week track by $index\" ng-click=\"select(day, $event)\">",'                        <div class="nz-datepicker-calendar-day-wrapper">{{day.date.date()}}</div>',"                    </td>","                </tr>","            </table>","        </div>",'        <a ng-click="move(+1, $event)" class="nz-datepicker-next-month">&#9654;</a>',"    </div>",'    <div class="nz-datepicker-panel">','       <span ng-show="showRanged">','           <select ng-click="prevent_select($event)" ng-model="quick" ng-options="e.range as e.label for e in quickList">',"           </select>","       </span>",'        <span class="nz-datepicker-buttons"><a ng-click="ok($event)" class="nz-datepicker-apply">Apply</a><a ng-click="hide($event)" class="nz-datepicker-cancel">cancel</a></span>',"    </div>","</div>"].join("");return{restrict:"AE",replace:!1,template:['<span tabindex="0" ng-keydown="hide()" class="nz-datepicker-input">','     <span ng-if="showRanged">','          <span ng-show="!!model">{{model.start.format("ll")}}-{{model.end.format("ll")}}</span>','          <span ng-hide="!!model">Select date range</span>',"     </span>",'     <span ng-if="!showRanged">','          <span ng-show="!!model">{{model.format("ll")}}</span>','          <span ng-hide="!!model">Select date</span>',"     </span>","</span>"].join(""),scope:{model:"=ngModel",options:"=?",ranged:"=",pastDates:"@",callback:"&"},link:function(o,r){function s(){return[{label:"This week",range:moment().range(moment().startOf("week").startOf("day"),moment().endOf("week").startOf("day"))},{label:"Next week",range:moment().range(moment().startOf("week").add(1,"week").startOf("day"),moment().add(1,"week").endOf("week").startOf("day"))},{label:"This fortnight",range:moment().range(moment().startOf("week").startOf("day"),moment().add(1,"week").endOf("week").startOf("day"))},{label:"This month",range:moment().range(moment().startOf("month").startOf("day"),moment().endOf("month").startOf("day"))},{label:"Next month",range:moment().range(moment().startOf("month").add(1,"month").startOf("day"),moment().add(1,"month").endOf("month").startOf("day"))}]}function i(){return o.selection=o.model,h(),y(),o.visible=!0}function d(e){return null!=e&&"function"==typeof e.stopPropagation&&e.stopPropagation(),o.visible=!1,o.start=null}function l(e){return null!=e&&"function"==typeof e.stopPropagation?e.stopPropagation():void 0}function c(e){return null!=e&&"function"==typeof e.stopPropagation&&e.stopPropagation(),o.model=o.selection,t(function(){return o.callback?o.callback():void 0}),o.hide()}function m(e,t){return null!=t&&"function"==typeof t.stopPropagation&&t.stopPropagation(),e.disabled?void 0:(o.showRanged?(o.selecting=!o.selecting,o.selecting?o.start=e.date:(o.selection=o.start.diff(e.date,"days")>0?moment().range(e.date,o.start):moment().range(o.start,e.date),o.start=null)):o.selection=moment(e.date),y())}function p(e,t){return null!=t&&"function"==typeof t.stopPropagation&&t.stopPropagation(),o.showRanged?o.range=moment().range(o.range.start.add(e,"months").startOf("month").startOf("day"),o.range.start.clone().add(2,"months").endOf("month").startOf("day")):(o.date.add(e,"months"),o.range=moment().range(moment(o.date).startOf("month"),moment(o.date).endOf("month"))),y()}function u(e){return null!=e&&"function"==typeof e.stopPropagation?e.stopPropagation():void 0}function g(){return o.$apply(function(){return o.hide()}),!0}function f(e){var t,a,r,s,i;if(null==e&&(e=!1),o.showRanged){for(o.quickList=[],e&&o.quickList.push({label:"Custom",range:n}),s=o.options,i=[],a=0,r=s.length;r>a;a++)t=s[a],i.push(o.quickList.push(t));return i}}function h(){var e,t;return o.showRanged?o.range=o.selection?(t=o.selection.start.clone().startOf("month").startOf("day"),e=t.clone().add(2,"months").endOf("month").startOf("day"),moment().range(t,e)):moment().range(moment().startOf("month").subtract(1,"month").startOf("day"),moment().endOf("month").add(1,"month").startOf("day")):(o.selection=!1,o.selection=o.model||!1,o.date=moment(o.model)||moment(),o.range=moment().range(moment(o.date).startOf("month"),moment(o.date).endOf("month")))}function k(){var e,t,a,r;if(o.showRanged&&o.selection){for(r=o.quickList,t=0,a=r.length;a>t;t++)if(e=r[t],e.range!==n&&o.selection.start.startOf("day").unix()===e.range.start.startOf("day").unix()&&o.selection.end.startOf("day").unix()===e.range.end.startOf("day").unix())return o.quick=e.range,void f();return o.quick=n,f(!0)}}function y(){var e,t,n,a,r,s;for(o.months=[],s=12*o.range.start.year()+o.range.start.month(),r=moment().startOf("week").day(),o.range.by("days",function(e){var t,n,a,i,d,l,c;return a=e.day()-r,0>a&&(a=7+a),d=12*e.year()+e.month()-s,c=parseInt((7+e.date()-a)/7),l=!1,i=!1,o.showRanged?o.start?(l=e===o.start,i=e<o.start):l=o.selection&&o.selection.contains(e):(l=e.isSame(o.selection),o.pastDates&&(i=moment().diff(e,"days")>0)),(t=o.months)[d]||(t[d]={name:e.format("MMMM YYYY"),weeks:[]}),(n=o.months[d].weeks)[c]||(n[c]=[]),o.months[d].weeks[c][a]={date:e,selected:l,disabled:!1,start:o.start&&o.start.unix()===e.unix()}}),a=o.months,e=0,t=a.length;t>e;e++)n=a[e],n.weeks[0]||n.weeks.splice(0,1);return k()}var v=e(angular.element(a))(o);return angular.element(document.body).append(v),o.quick=null,o.range=null,o.selecting=!1,o.visible=!1,o.start=null,o.showRanged=void 0===o.ranged?!0:o.ranged,o.options&&o.options.length||(o.options=s()),o.show=i,o.hide=d,o.prevent_select=l,o.ok=c,o.select=m,o.move=p,o.handlePickerClick=u,angular.element(document).bind("click",g),r.bind("click",function(e){return null!=e&&"function"==typeof e.stopPropagation&&e.stopPropagation(),o.$apply(function(){return o.visible?o.hide():o.show()})}),o.$watch("quick",function(e){return e&&e!==n?(o.selection=o.quick,o.selecting=!1,o.start=null,h(),y()):void 0}),o.$watch("options",function(e){return"undefined"!=typeof options&&null!==options?o.options=e:void 0}),o.$on("$destroy",function(){return angular.element(document).unbind("click",g)}),f(),h(),y()}}}])}();