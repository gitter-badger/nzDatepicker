!function(){var e=angular.module("nzDatepicker",[]);e.directive("nzDatepicker",["$compile","$timeout",function(e,t){var n="CUSTOM";return{restrict:"AE",replace:!0,template:['<span tabindex="0" ng-keydown="hide()" class="nz-datepicker-input">','     <span ng-if="showRanged">','          <span ng-show="!!model">{{model.start.format("ll")}}-{{model.end.format("ll")}}</span>','          <span ng-hide="!!model">Select date range</span>',"     </span>",'     <span ng-if="!showRanged">','          <span ng-show="!!model">{{model.format("ll")}}</span>','          <span ng-hide="!!model">Select date</span>',"     </span>","</span>"].join(""),scope:{model:"=ngModel",options:"=",ranged:"=",pastDates:"@",callback:"&"},link:function(a,o){function r(){return[{label:"This week",range:moment().range(moment().startOf("week").startOf("day"),moment().endOf("week").startOf("day"))},{label:"Next week",range:moment().range(moment().startOf("week").add(1,"week").startOf("day"),moment().add(1,"week").endOf("week").startOf("day"))},{label:"This fortnight",range:moment().range(moment().startOf("week").startOf("day"),moment().add(1,"week").endOf("week").startOf("day"))},{label:"This month",range:moment().range(moment().startOf("month").startOf("day"),moment().endOf("month").startOf("day"))},{label:"Next month",range:moment().range(moment().startOf("month").add(1,"month").startOf("day"),moment().add(1,"month").endOf("month").startOf("day"))}]}function s(){return a.selection=a.model,f(),k(),a.visible=!0}function i(e){return null!=e&&"function"==typeof e.stopPropagation&&e.stopPropagation(),a.visible=!1,a.start=null}function d(e){return null!=e&&"function"==typeof e.stopPropagation?e.stopPropagation():void 0}function l(e){return null!=e&&"function"==typeof e.stopPropagation&&e.stopPropagation(),a.model=a.selection,t(function(){return a.callback?a.callback():void 0}),a.hide()}function c(e,t){return null!=t&&"function"==typeof t.stopPropagation&&t.stopPropagation(),e.disabled?void 0:(a.showRanged?(a.selecting=!a.selecting,a.selecting?a.start=e.date:(a.selection=moment().range(a.start,e.date),a.start=null)):a.selection=moment(e.date),k())}function m(e,t){return null!=t&&"function"==typeof t.stopPropagation&&t.stopPropagation(),a.showRanged?a.range=moment().range(a.range.start.add(e,"months").startOf("month").startOf("day"),a.range.start.clone().add(2,"months").endOf("month").startOf("day")):(a.date.add(e,"months"),a.range=moment().range(moment(a.date).startOf("month"),moment(a.date).endOf("month"))),k()}function p(e){return null!=e&&"function"==typeof e.stopPropagation?e.stopPropagation():void 0}function u(){return a.$apply(function(){return a.hide()}),!0}function g(e){var t,o,r,s,i;if(null==e&&(e=!1),a.showRanged){for(a.quickList=[],e&&a.quickList.push({label:"Custom",range:n}),s=a.options,i=[],o=0,r=s.length;r>o;o++)t=s[o],i.push(a.quickList.push(t));return i}}function f(){var e,t;return a.showRanged?a.range=a.selection?(t=a.selection.start.clone().startOf("month").startOf("day"),e=t.clone().add(2,"months").endOf("month").startOf("day"),moment().range(t,e)):moment().range(moment().startOf("month").subtract(1,"month").startOf("day"),moment().endOf("month").add(1,"month").startOf("day")):(a.selection=!1,a.selection=a.model||!1,a.date=moment(a.model)||moment(),a.range=moment().range(moment(a.date).startOf("month"),moment(a.date).endOf("month")))}function h(){var e,t,o,r;if(a.showRanged&&a.selection){for(r=a.quickList,t=0,o=r.length;o>t;t++)if(e=r[t],e.range!==n&&a.selection.start.startOf("day").unix()===e.range.start.startOf("day").unix()&&a.selection.end.startOf("day").unix()===e.range.end.startOf("day").unix())return a.quick=e.range,void g();return a.quick=n,g(!0)}}function k(){var e,t,n,o,r,s;for(a.months=[],s=12*a.range.start.year()+a.range.start.month(),r=moment().startOf("week").day(),a.range.by("days",function(e){var t,n,o,i,d,l,c;return o=e.day()-r,0>o&&(o=7+o),d=12*e.year()+e.month()-s,c=parseInt((7+e.date()-o)/7),l=!1,i=!1,a.showRanged?a.start?(l=e===a.start,i=e<a.start):l=a.selection&&a.selection.contains(e):(l=e.isSame(a.selection),a.pastDates&&(i=moment().diff(e,"days")>0)),(t=a.months)[d]||(t[d]={name:e.format("MMMM YYYY"),weeks:[]}),(n=a.months[d].weeks)[c]||(n[c]=[]),a.months[d].weeks[c][o]={date:e,selected:l,disabled:i,start:a.start&&a.start.unix()===e.unix()}}),o=a.months,e=0,t=o.length;t>e;e++)n=o[e],n.weeks[0]||n.weeks.splice(0,1);return h()}function y(){return['<div ng-show="visible" class="nz-datepicker-picker" ng-click="handlePickerClick($event)" ng-class="{\'nz-datepicker-ranged\': showRanged }">,','    <div class="nz-datepicker-timesheet">,','        <a ng-click="move(-1, $event)" class="nz-datepicker-prev-month">&#9664;</a>,','        <div ng-repeat="month in ::months" class="nz-datepicker-month">,','            <div class="nz-datepicker-month-name" bo-text="month.name"></div>,','            <table class="nz-datepicker-calendar">,',"                <tr>,",'                    <th ng-repeat="day in ::month.weeks[1]" class="nz-datepicker-calendar-weekday" bo-text="day.date.format(dd)">,',"                    </th>","                </tr>",'                <tr ng-repeat="week in ::month.weeks">,',"                    <td bo-class=\"{'nz-datepicker-calendar-day': day,'nz-datepicker-calendar-day-selected': day.selected,'nz-datepicker-calendar-day-disabled': day.disabled,'nz-datepicker-calendar-day-start': day.start}\" ng-repeat=\"day in week track by $index\" ng-click=\"select(day, $event)\">",'                        <div class="nz-datepicker-calendar-day-wrapper" bo-text="day.date.date()"></div>',"                    </td>","                </tr>","            </table>","        </div>",'        <a ng-click="move(+1, $event)" class="nz-datepicker-next-month">&#9654;</a>',"    </div>",'    <div class="nz-datepicker-panel">','        <div ng-show="showRanged">','            Select range:<select ng-click="prevent_select($event)" ng-model="quick" ng-options="e.range as e.label for e in quickList"></select>',"        </div>",'        <div class="nz-datepicker-buttons"><a ng-click="ok($event)" class="nz-datepicker-apply">Apply</a><a ng-click="hide($event)" class="nz-datepicker-cancel">cancel</a></div>',"    </div>","</div>"].join("")}var v=e(y())(a);return a.quick=null,a.range=null,a.selecting=!1,a.visible=!1,a.start=null,a.showRanged=void 0===a.ranged?!0:a.ranged,o.append(v),a.options&&a.options.length||(a.options=r()),a.show=s,a.hide=i,a.prevent_select=d,a.ok=l,a.select=c,a.move=m,a.handlePickerClick=p,angular.element(document).bind("click",u),o.bind("click",function(e){return null!=e&&"function"==typeof e.stopPropagation&&e.stopPropagation(),a.$apply(function(){return a.visible?a.hide():a.show()})}),a.$watch("quick",function(e){return e&&e!==n?(a.selection=a.quick,a.selecting=!1,a.start=null,f(),k()):void 0}),a.$watch("options",function(e){return"undefined"!=typeof options&&null!==options?a.options=e:void 0}),a.$on("$destroy",function(){return angular.element(document).unbind("click",u)}),g(),f(),k()}}}])}();